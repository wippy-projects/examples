version: "1.0"
namespace: app

entries:
  # --- Infrastructure ---

  - name: processes
    kind: process.host
    host:
      workers: 4
    lifecycle:
      auto_start: true

  - name: gateway
    kind: http.service
    addr: ":8080"
    lifecycle:
      auto_start: true

  - name: router
    kind: http.router
    meta:
      server: app:gateway
    prefix: /api

  # --- Handlers ---

  - name: process_task
    kind: function.lua
    source: file://handler.lua
    method: handler
    modules:
      - http
      - json
      - time
      - logger

  - name: process_task.endpoint
    kind: http.endpoint
    meta:
      router: app:router
    method: POST
    path: /tasks
    func: app:process_task
